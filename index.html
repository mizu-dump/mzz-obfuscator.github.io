<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>MZ Obfuscator</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600&family=JetBrains+Mono&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box}
body{
  margin:0;
  background:#0c0f14;
  color:#fff;
  font-family:Orbitron,sans-serif;
  overflow-x:hidden;
}

/* ===== Drawer ===== */
#drawerBtn{
  position:fixed;
  top:14px;
  left:14px;
  width:42px;
  height:42px;
  border-radius:12px;
  border:none;
  cursor:pointer;
  background:linear-gradient(135deg,#6f737a,#d5d7db);
  z-index:10;
}
#drawer{
  position:fixed;
  left:-260px;
  top:0;
  width:260px;
  height:100%;
  background:#0f131b;
  padding:20px;
  transition:.35s;
  box-shadow:8px 0 40px rgba(0,0,0,.7);
}
#drawer.open{left:0}

/* ===== UI ===== */
.container{
  max-width:900px;
  margin:auto;
  padding:20px;
  text-align:center;
}
h1{
  background:linear-gradient(135deg,#6f737a,#d5d7db,#5b5f66);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
}
.box{
  background:#11151d;
  padding:20px;
  border-radius:14px;
}
input,button{
  width:100%;
  margin-top:14px;
  padding:14px;
  border-radius:12px;
  border:none;
  font-family:Orbitron;
}
input{background:#0f131b;color:#aaa}
button{background:linear-gradient(135deg,#5f6368,#b0b3b8);color:#000}
textarea{
  display:none;
  width:100%;
  height:280px;
  background:#0f131b;
  color:#cfd2d6;
  border-radius:12px;
  padding:15px;
  font-family:"JetBrains Mono";
  font-size:.75em;
}
.progress{
  height:10px;
  background:#222;
  border-radius:20px;
  overflow:hidden;
  margin-top:10px;
}
.bar{
  height:100%;
  width:0%;
  background:linear-gradient(135deg,#5f6368,#b0b3b8);
}
.actions{display:none;gap:10px;margin-top:10px}
</style>
</head>

<body>

<button id="drawerBtn">☰</button>
<div id="drawer">
  <h3>MZ Obfuscator</h3>
  <p style="opacity:.6;font-size:.8em">
    • VM execution<br>
    • Fake opcodes<br>
    • Flow flattening<br>
    • Anti‑tamper<br>
    • Runtime decrypt
  </p>
</div>

<div class="container">
<h1>MZ Obfuscator</h1>

<div class="box">
<input type="file" id="file" accept=".lua,.txt">
<button onclick="start()">OBFUSCATE</button>

<div class="progress"><div class="bar" id="bar"></div></div>

<textarea id="out" readonly></textarea>
<div class="actions" id="actions">
<button onclick="copy()">COPY</button>
<button onclick="download()">DOWNLOAD</button>
</div>
</div>
</div>

<script>
drawerBtn.onclick=()=>drawer.classList.toggle("open");

function start(){
  const f=file.files[0];
  if(!f)return alert("Select file");
  const r=new FileReader();
  r.onload=()=>process(r.result);
  r.readAsText(f);
}

function process(code){
  let p=0;
  out.style.display="none";
  actions.style.display="none";
  const i=setInterval(()=>{
    p+=Math.random()*15;
    bar.style.width=Math.min(p,100)+"%";
    if(p>=100){
      clearInterval(i);
      out.value=obfuscate(code);
      out.style.display="block";
      actions.style.display="flex";
    }
  },160);
}

/* ===== REAL VM OBFUSCATION ===== */
function obfuscate(src){
  const key=Math.floor(Math.random()*9000)+1000;

  const bytes=[...src].map(c=>c.charCodeAt(0)^key);
  const ops=[];

  for(let i=0;i<bytes.length;i++){
    ops.push([
      Math.random()>0.5?1:3,
      bytes[i],
      Math.floor(Math.random()*9999)
    ]);
    if(Math.random()>0.6)
      ops.push([9,Math.floor(Math.random()*9999),0]); // junk
  }

  const checksum=ops.reduce((a,b)=>a+(b[1]||0),0)%9999991;

return `
--[[ MZ VM PROTECTED | v1 ]]
local O=${JSON.stringify(ops)}
local K=${key}
local C=${checksum}

local pc=1
local st={}
local out={}
local chk=0

while pc<=#O do
  local i=O[pc]
  if i[1]==1 then
    chk=(chk+i[2])%9999991
    out[#out+1]=string.char(bit32.bxor(i[2],K))
  elseif i[1]==3 then
    chk=(chk+i[2])%9999991
    out[#out+1]=string.char(bit32.bxor(i[2],K))
  else
    chk=(chk+i[2])%9999991
  end
  pc=pc+1
end

if chk~=C then return end
local f=load(table.concat(out))
if f then pcall(f) end
`;
}

function copy(){navigator.clipboard.writeText(out.value)}
function download(){
  const a=document.createElement("a");
  a.href=URL.createObjectURL(new Blob([out.value]));
  a.download="obfuscated.lua";
  a.click();
}
</script>

</body>
</html>
